<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crop Prediction</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f9; display:flex; justify-content:center; align-items:center; height:100vh; }
        .container { background:#fff; padding:22px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.08); width:360px; }
        h2 { text-align:center; margin-bottom:14px; color:#222; }
        label { font-weight:600; margin-top:10px; display:block; font-size:14px; }
        input, select, button { width:100%; padding:9px; margin-top:6px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; }
        button { background:#28a745; color:#fff; border:none; cursor:pointer; font-weight:700; }
        button:hover{ opacity:0.95; }
        #result { margin-top:16px; text-align:center; font-size:16px; color:#0056b3; min-height:22px; }
        .small { font-size:13px; color:#666; margin-top:6px; text-align:center; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Crop Prediction</h2>
        <form id="predictForm">
            <label>Temperature</label>
            <input id="temperature" type="number" step="any" required />

            <label>Humidity</label>
            <input id="humidity" type="number" step="any" required />

            <label>pH</label>
            <input id="ph" type="number" step="any" required />

            <label>Rainfall</label>
            <input id="rainfall" type="number" step="any" required />

            <label>Division</label>
            <select id="divisions" required>
                <option value="">-- Loading options --</option>
            </select>

            <label>State</label>
            <select id="States" required>
                <option value="">-- Loading options --</option>
            </select>

            <button type="submit">Predict Crop</button>
        </form>

        <div id="result"></div>
        <div class="small">Dropdown values are loaded from the dataset to avoid invalid inputs.</div>
    </div>

    <script>
    // Populate dropdowns from /options endpoint
    async function loadOptions() {
        try {
            const res = await fetch('/options');
            if (!res.ok) throw new Error('Failed to load options');
            const opts = await res.json();

            const divSelect = document.getElementById('divisions');
            const stSelect = document.getElementById('States');

            // clear existing
            divSelect.innerHTML = '<option value="">-- Select Division --</option>';
            stSelect.innerHTML = '<option value="">-- Select State --</option>';

            if (Array.isArray(opts.divisions)) {
                opts.divisions.forEach(v => {
                    const o = document.createElement('option');
                    o.value = v;
                    o.textContent = v;
                    divSelect.appendChild(o);
                });
            }

            if (Array.isArray(opts.States)) {
                opts.States.forEach(v => {
                    const o = document.createElement('option');
                    o.value = v;
                    o.textContent = v;
                    stSelect.appendChild(o);
                });
            }
        } catch (err) {
            document.getElementById('result').textContent = 'Could not load dropdown options. Check server / DataSet.csv.';
            // Keep placeholders so user sees failure
        }
    }

    document.addEventListener('DOMContentLoaded', loadOptions);

    document.getElementById('predictForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const resultDiv = document.getElementById('result');

        const inputData = {
            temperature: parseFloat(document.getElementById('temperature').value),
            humidity: parseFloat(document.getElementById('humidity').value),
            ph: parseFloat(document.getElementById('ph').value),
            rainfall: parseFloat(document.getElementById('rainfall').value),
            divisions: document.getElementById('divisions').value,
            States: document.getElementById('States').value
        };

        // basic client-side validation
        if (!inputData.divisions || !inputData.States) {
            resultDiv.textContent = 'Please select Division and State.';
            return;
        }

        resultDiv.textContent = 'Predicting...';

        try {
            const res = await fetch('/predict_crop', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(inputData)
            });

            const j = await res.json();
            if (res.ok && j.predicted_crop_label) {
                resultDiv.textContent = 'Predicted Crop: ' + j.predicted_crop_label;
            } else {
                resultDiv.textContent = 'Error: ' + (j.error || 'Unknown error');
            }
        } catch (err) {
            resultDiv.textContent = 'Error connecting to server.';
        }
    });
    </script>
</body>
</html>

